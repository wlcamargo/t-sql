--FUNÇÃO DE JANELA
--ACUMULAR O VAL_VENDA POR MES E ANO


DROP TABLE IF EXISTS fVendas 
GO

CREATE TABLE fVendas (
	DATA_VENDA DATE,
	VAL_VENDA MONEY
)
GO

INSERT INTO fVendas VALUES 
('2021-01-01',2500),
('2021-02-01',2500),
('2021-03-01',2500),
('2021-04-01',2500),
('2021-05-01',2500),
('2021-06-01',2500),
('2021-07-01',2500),
('2021-08-01',2500),
('2021-09-01',2500),
('2021-10-01',2500),
('2021-11-01',2500),
('2021-12-01',2500),
('2022-01-01',2500),
('2022-02-01',2500)
GO

SELECT 
	ANO,
	MES,
	VAL_TOTAL,
	SUM(VAL_TOTAL) OVER (PARTITION BY ANO ORDER BY MES) AS TOTAL_ACC
FROM
(
		SELECT
			DATEPART(YY,DATA_VENDA) AS ANO,
			DATEPART(MM,DATA_VENDA) AS MES,
			SUM(VAL_VENDA) AS VAL_TOTAL
		FROM 
			fVendas
		GROUP BY 
			DATEPART(YY,DATA_VENDA),
			DATEPART(MM,DATA_VENDA) 
) AS TB